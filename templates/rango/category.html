{% extends 'rango/base.html' %}
{% load static %}

{% block title_block %}
    {% if category %}
        {{ category.name }}
    {% else %}
        Unknown Category
    {% endif %}
{% endblock %}

{% block body_block %}
    {% if category %}
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h1>{{ category.name }}</h1>
            <div>
                <button id="like-btn" class="btn btn-success" data-categoryid="{{ category.id }}">
                    <span id="like-count">{{ category.likes }}</span> Likes
                </button>
            </div>
        </div>
        
        {% if pages %}
            <div class="list-group mb-3">
                {% for page in pages %}
                    <a href="{{ page.url }}" class="list-group-item list-group-item-action">
                        {{ page.title }}
                    </a>
                {% endfor %}
            </div>
        {% else %}
            <p><strong>No pages currently in category.</strong></p>
        {% endif %}
        
        {% if user.is_authenticated %}
            <a href="{% url 'rango:add_page' category.slug %}" class="btn btn-primary">Add Page</a>
        {% endif %}
    {% else %}
        <p>The specified category does not exist.</p>
    {% endif %}
{% endblock %}

{% block body_block %}
{{ block.super }}
<script>
    document.getElementById('like-btn').addEventListener('click', function() {
        var categoryId = this.getAttribute('data-categoryid');
        fetch('/rango/like_category/?category_id=' + categoryId)
            .then(response => response.text())
            .then(data => {
                document.getElementById('like-count').textContent = data;
            });
    });
</script>
{% endblock %}
